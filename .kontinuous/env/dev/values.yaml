app:
  annotations:
    oblik.socialgouv.io/min-limit-cpu: 2
  env:
    - name: E2E_CLEANUP_TOKEN
      valueFrom:
        secretKeyRef:
          name: "egapro-secret"
          key: E2E_CLEANUP_TOKEN
          optional: true
  envFrom:
    - configMapRef:
        name: "proconnect"
        optional: true
    - secretRef:
        name: "proconnect"
        optional: true
  vars:
    MAILER_ENABLE: "True"
    MAILER_SMTP_HOST: maildev
    MAILER_SMTP_PORT: "1025"
    MAILER_SMTP_SSL: "False"
    # Note: EGAPRO_PROCONNECT_ISSUER sera surchargé par le ConfigMap avec l'URL externe
    # L'URL interne est gardée ici comme fallback pour les tests locaux
    EGAPRO_PROCONNECT_DISCOVERY_URL: "http://localhost:8080/realms/atlas/.well-known/openid-configuration"

keycloak:
  ~chart: app
  imagePackage: keycloak
  annotations:
    oblik.socialgouv.io/min-request-memory: "512Mi"
    oblik.socialgouv.io/min-limit-memory: "1Gi"
  containerPort: 8080
  probesPath: /
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  env:
    - name: E2E_USERNAME
      valueFrom:
        secretKeyRef:
          name: "egapro-secret"
          key: E2E_USERNAME
          optional: true
    - name: E2E_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "egapro-secret"
          key: E2E_PASSWORD
          optional: true
  vars:
    KEYCLOAK_ADMIN: admin
    KEYCLOAK_ADMIN_PASSWORD: admin
    KEYCLOAK_CLIENT_SECRET: dev-secret-key-for-local-development-only
    KC_PROXY: edge
    KC_HOSTNAME_STRICT: "false"
    EGAPRO_ORIGIN: "https://egapro-{{ .Values.global.branchSlug }}.ovh.fabrique.social.gouv.fr"

maildev: {}
pgweb: {}

nginx:
  annotations:
    oblik.socialgouv.io/min-limit-cpu: 2
  ingress:
    annotations:
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
