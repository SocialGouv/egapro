api:
  ~needs: [build-api,create-db]
  vars:
    EGAPRO_SEND_EMAILS: "True"
    EGAPRO_SMTP_HOST: maildev
    EGAPRO_SMTP_PORT: "1025"
    EGAPRO_SMTP_LOGIN: ""
    EGAPRO_SMTP_PASSWORD: ""
    EGAPRO_SMTP_SSL: ""

app:
  vars:
    MAILER_ENABLE: "True"
    MAILER_SMTP_HOST: maildev
    MAILER_SMTP_PORT: "1025"
    MAILER_SMTP_LOGIN: ""
    MAILER_SMTP_PASSWORD: ""
    MAILER_SMTP_SSL: "False"

maildev: {}

pgadmin:
  ~chart: app
  ~needs: [build-pgadmin]
  imagePackage: pgadmin
  host: "pgadmin-{{ .Values.global.host }}"
  probesPath: /misc/ping
  certSecretName: api-crt

jobs:
  runs:
    create-db:
      use: create-db
    build-pgadmin:
      use: build
      envFrom:
        - secretRef:
            name: "{{ .Values.global.pgSecretName }}"
      with:
        imagePackage: pgadmin
        context: docker/pgadmin
        buildArgs:
          PGHOST: "$(PGHOST)"
          PGDATABASE: "$(PGDATABASE)"
          PGPORT: "$(PGPORT)"
          PGUSER: "$(PGUSER)"
          PGPASSWORD: "$(PGPASSWORD)"
          PGSSLMODE: "$(PGSSLMODE)"