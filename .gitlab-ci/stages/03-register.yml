---

include:
  - project: SocialGouv/gitlab-ci-yml
    file: /base_register_stage.yml
    ref: master

#
.register_stage: &register_stage
  extends: .base_register_stage
  stage: "Registration"
  except:
    variables:
      - $PRODUCTION
#

Register api image commit sha:
  <<: *register_stage
  variables:
    CONTEXT: packages/kinto
    DOCKERFILE_PATH: packages/api/Dockerfile
    IMAGE_NAME: ${CI_REGISTRY_IMAGE}/api

Register app image commit sha:
  <<: *register_stage
  variables:
    CONTEXT: packages/kinto
    DOCKERFILE_PATH: packages/app/Dockerfile
    IMAGE_NAME: ${CI_REGISTRY_IMAGE}/app

Register init kinto image commit sha:
  <<: *register_stage
  variables:
    CONTEXT: packages/kinto
    DOCKERFILE_PATH: packages/kinto/Dockerfile
    IMAGE_NAME: ${CI_REGISTRY_IMAGE}/kinto

...
